{% extends "base.html" %}
{% load staticfiles bootstrap3 i18n %}
{% block extra_css %}
    <!-- *********** -->
    {{ form.media }}
    <!-- *********** -->
{% endblock extra_css %}
{% block page_title %}
    {% if project == None %}
        Add New Project
    {% else %}
        {{ project.short_name }}
    {% endif %}
{% endblock page_title %}

{% block content %}
    <form action="" method="post">{% csrf_token %}


        <div class="tab-content">

            <div role="tabpanel" class="tab-pane active" id="project-info">
                {% bootstrap_form form %}
            </div>

            <div role="tabpanel" class="tab-pane active" id="risks">
                <fieldset>
                    <legend>Risks</legend>
                    {{ line_formset.management_form }}
                    {{ line_formset.non_form_errors }}
                    {% for form in line_formset %}
                        {{ form.id }}
                        <div class="link-formset inline {{ risk_form.prefix }}">
                            {% bootstrap_form form layout='horizontal' %}
                        </div>
                    {% endfor %}
                </fieldset>
            </div>
            <div role="tabpanel" class="tab-pane active" id="members">


                {{ members_formset.management_form }}
                {{ members_formset.non_field_errors }}
                <table class="table table-striped table-bordered">
                    <thead>
                    <th>#</th>
                    <th>Role</th>
                    <th>Employee</th>
                    <th>Start Date</th>
                    <th>EndDate.</th>
                    <th></th>
                    </thead>
                    <tbody>
                    {% for line_form in members_formset %}
                        <tr class="members-formset inline {{ line_form.prefix }}">
                            <td class="col-md-0 counter">
                                {{ forloop.counter }}
                                {{ line_form.id }}
                            </td>
                            <td class="col-md-2">
                                {% bootstrap_field line_form.role show_label=False %}
                            </td>
                            <td class="col-md-4">
                                {% bootstrap_field line_form.employee show_label=False %}
                            </td>
                            <td class="col-md-2">
                                {% bootstrap_field line_form.start_date show_label=False %}
                            </td>
                            <td class="col-md-1">
                                {% bootstrap_field line_form.end_date show_label=False %}
                                
                            </td>
                            <td></td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>

            </div>
            <div role="tabpanel" class="tab-pane active" id="deliverables">
                <fieldset>
                    <legend>Deliverables</legend>
                    {{ deliverables_formset.management_form }}
                    {{ deliverables_formset.non_form_errors }}
                    {% for form in deliverables_formset %}
                        {{ form.id }}
                        <div class="deliverables-formset inline {{ form.prefix }}">
                            {{ form.as_table }}
                        </div>
                    {% endfor %}
                </fieldset>
            </div>
        </div>
        <input class="btn btn-primary" role="button" type="submit" value="Update"/>
        {% if project == None %}
            <a class="btn btn-primary" role="button" href="{% url 'project:all_projects' %} ">Cancel</a>
        {% else %}
            <a class="btn btn-primary" role="button" href="{% url 'project:project_detail' project.pk %} ">Cancel</a>
        {% endif %}

    </form>
{% endblock content %}

{% block extra_js %}
    <script src="{% static 'js/jquery.formset.js' %}"></script>
    <script>
        $('.link-formset').formset({
            addText: 'Add Risk',
            deleteText: 'Delete'
        });

        $('.members-formset').formset({
            prefix: 'members',
            addText: 'Add Member',
            deleteText: 'Delete',
            addCssClass: 'btn btn-primary btn-sm',
            deleteCssClass: 'btn btn-danger btn-sm',
        });

        $('.deliverables-formset').formset({
            prefix: 'deliverables',
            addText: 'Add Deliverable',
            deleteText: 'Delete',
            addCssClass: 'btn btn-primary btn-sm',
            deleteCssClass: 'btn btn-danger btn-sm',
        });


    </script>

{% endblock extra_js %}